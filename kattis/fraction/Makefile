# Makefile
# $@ : name on the left side of a : (the rule)
# $< : first name of the right side of a :

CC = g++
FLAGS = -std=c++17 -Wall -Wconversion -Wfatal-errors -g -fsanitize=undefined,address

TARGET = main
TESTS = $(wildcard test/*.in)

all: $(TARGET).out

$(TARGET).out : $(TARGET).cpp
	$(CC) $(FLAGS) -o $@ $<

run: $(TARGET).out
	./main.out


# Tests in /test, donno about PHONY should google it some day...
.PHONY: clean test
test: $(TARGET).out
	for t in $(TESTS) ; do echo $$t && \
	./$(TARGET).out < $$t > $${t%.*}.res && \
	diff $${t%.*}.ans $${t%.*}.res || exit 0 ; done

clean:
	rm $(TARGET).out
	rm test/*.res
